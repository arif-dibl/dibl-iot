{% extends "base.html" %}

{% block title %}My IoT Devices{% endblock %}
{% block header %}My IoT Devices{% endblock %}

{% block content %}
<div class="action-bar" style="margin-bottom: 2rem;">
    <button onclick="openLinkModal()" style="width: auto; margin:0; display:flex; align-items:center; gap:8px;">
        <span style="font-size:1.2rem; font-weight:bold;">+</span> Link New IoT Device
    </button>
</div>

<!-- Assets Grid -->
<div id="assetsGrid" style="display:flex; flex-direction:column; gap:1rem;">
    <!-- Populated by JS -->
    <div style="text-align:center; padding:3rem; color:var(--text-muted);">
        Loading assets...
    </div>
</div>



<!-- Add/Link Asset Modal -->
<div class="modal-overlay" id="linkAssetModal">
    <div class="modal-content">
        <h3 style="margin-bottom:1.5rem;">Link an IoT Device</h3>
        <p style="margin-bottom:1rem; color:var(--text-muted); font-size:0.9rem;">
            Enter the ID of an existing device in the system to link it to your account.
        </p>
        <div class="form-group">
            <label>IoT Device ID</label>
            <input type="text" id="linkAssetId" placeholder="e.g. 5r3353...">
        </div>
        <div style="display:flex; justify-content:flex-end; gap:1rem; margin-top:2rem;">
            <button class="btn-ghost btn-sm" onclick="closeLinkModal()">Cancel</button>
            <button class="btn-sm" onclick="linkAsset()">Link IoT Device</button>
        </div>
    </div>
</div>

<!-- Edit Asset Modal -->
<div class="modal-overlay" id="editAssetModal">
    <div class="modal-content">
        <h3 style="margin-bottom:1.5rem;">Edit Asset</h3>
        <input type="hidden" id="editAssetId">
        <div class="form-group">
            <label>Asset Name</label>
            <input type="text" id="editAssetName" placeholder="Enter new name">
        </div>
        <div style="display:flex; justify-content:flex-end; gap:1rem; margin-top:2rem;">
            <button class="btn-ghost btn-sm" onclick="closeEditModal()">Cancel</button>
            <button class="btn-sm" onclick="updateAssetName()">Save Changes</button>
        </div>
    </div>
</div>
</div>

<!-- Show ID Modal -->
<div class="modal-overlay" id="showIdModal">
    <div class="modal-content" style="position:relative; width:90%; max-width:400px; padding-top:2.5rem;">
        <span onclick="closeIdModal()"
            style="position:absolute; top:10px; right:15px; font-size:1.5rem; cursor:pointer; color:#999; font-weight:bold;">&times;</span>
        <h3 style="margin-top:0; text-align:center;">IoT Device ID</h3>
        <div
            style="background:#f8f9fa; padding:1rem; border:1px solid #eee; border-radius:4px; font-family:monospace; font-size:1.2rem; text-align:center; margin:1.5rem 0; word-break:break-all;">
            <span id="displayAssetId"></span>
        </div>
        <div style="text-align:center;">
            <button class="btn-sm" onclick="copyIdToClipboard()">Copy to Clipboard</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', path='js/assets.js') }}"></script>
{% endblock %}