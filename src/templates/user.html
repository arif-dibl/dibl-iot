{% extends "base.html" %}

{% block title %}User Profile{% endblock %}
{% block header %}User Profile{% endblock %}

{% block content %}
<div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); max-width: 1000px;">

    <!-- Profile Card -->
    <div class="card">
        <div
            style="display:flex; align-items:center; gap:1rem; margin-bottom:1.5rem; padding-bottom:1rem; border-bottom:1px solid var(--border);">
            <div
                style="width:56px; height:56px; background:linear-gradient(135deg, var(--primary), #00d4aa); border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-size:1.5rem; font-weight:700;">
                <span id="avatar">U</span>
            </div>
            <div>
                <h3 style="margin:0; font-size:1.25rem;" id="displayName">Loading...</h3>
                <div style="color:var(--text-muted); font-size:0.9rem;" id="displayEmail">-</div>
            </div>
        </div>

        <div id="profile-loading" style="text-align:center; padding:2rem; color:var(--text-muted);">
            Loading profile...
        </div>

        <form id="profile-form" style="display:none;">
            <div class="form-group" style="margin-bottom:1.25rem;">
                <label
                    style="display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.9rem; color:var(--text-muted);">Username</label>
                <input type="text" id="username" disabled class="form-input"
                    style="width:100%; padding:0.75rem; border:1px solid var(--border); background:var(--bg-light); color:var(--text-muted); border-radius:6px; font-size:0.95rem;">
            </div>

            <div class="form-group" style="margin-bottom:1.25rem;">
                <label
                    style="display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.9rem; color:var(--text-muted);">Email</label>
                <input type="email" id="email" disabled class="form-input"
                    style="width:100%; padding:0.75rem; border:1px solid var(--border); background:var(--bg-light); color:var(--text-muted); border-radius:6px; font-size:0.95rem;">
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin-bottom:1.25rem;">
                <div class="form-group">
                    <label
                        style="display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.9rem; color:var(--text-dark);">First
                        Name</label>
                    <input type="text" id="firstName" class="form-input"
                        style="width:100%; padding:0.75rem; border:1px solid var(--border); border-radius:6px; font-size:0.95rem;">
                </div>

                <div class="form-group">
                    <label
                        style="display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.9rem; color:var(--text-dark);">Last
                        Name</label>
                    <input type="text" id="lastName" class="form-input"
                        style="width:100%; padding:0.75rem; border:1px solid var(--border); border-radius:6px; font-size:0.95rem;">
                </div>
            </div>

            <button type="submit" class="btn-primary"
                style="width:100%; background:var(--primary); color:white; border:none; padding:0.85rem 1.5rem; border-radius:6px; font-weight:600; cursor:pointer; font-size:1rem; transition:background 0.2s;">
                Save Profile
            </button>
        </form>
    </div>

    <!-- Password Change Card -->
    <div class="card">
        <div
            style="display:flex; align-items:center; gap:0.75rem; margin-bottom:1.5rem; padding-bottom:1rem; border-bottom:1px solid var(--border);">

            <h3 style="margin:0; font-size:1.1rem;">Change Password</h3>
        </div>

        <form id="password-form">
            <div class="form-group" style="margin-bottom:1.25rem;">
                <label
                    style="display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.9rem; color:var(--text-dark);">Current
                    Password</label>
                <input type="password" id="currentPassword" placeholder="Enter current password" required
                    class="form-input"
                    style="width:100%; padding:0.75rem; border:1px solid var(--border); border-radius:6px; font-size:0.95rem;">
            </div>

            <div class="form-group" style="margin-bottom:1.25rem;">
                <label
                    style="display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.9rem; color:var(--text-dark);">New
                    Password</label>
                <input type="password" id="newPassword" placeholder="Enter new password" required class="form-input"
                    style="width:100%; padding:0.75rem; border:1px solid var(--border); border-radius:6px; font-size:0.95rem;">
            </div>

            <div class="form-group" style="margin-bottom:1.25rem;">
                <label
                    style="display:block; margin-bottom:0.5rem; font-weight:600; font-size:0.9rem; color:var(--text-dark);">Confirm
                    Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm new password" required
                    class="form-input"
                    style="width:100%; padding:0.75rem; border:1px solid var(--border); border-radius:6px; font-size:0.95rem;">
            </div>

            <button type="submit" class="btn-danger"
                style="width:100%; background:var(--danger); color:white; border:none; padding:0.85rem 1.5rem; border-radius:6px; font-weight:600; cursor:pointer; font-size:1rem; transition:background 0.2s;">
                Change Password
            </button>
        </form>

        <div style="margin-top:1.5rem; padding-top:1rem; border-top:1px solid var(--border); text-align:center;">
            <a href="{{ prefix }}/logout"
                style="color:var(--danger); font-weight:600; text-decoration:none; font-size:0.9rem;">
                Sign Out
            </a>
        </div>
    </div>

    <!-- Linked Users Card -->
    <div class="card" id="linked-users-card" style="display:none;">
        <div
            style="display:flex; align-items:center; gap:0.75rem; margin-bottom:1rem; padding-bottom:1rem; border-bottom:1px solid var(--border);">
            <h3 style="margin:0; font-size:1.1rem;">Linked Users</h3>
        </div>

        <div id="linked-users-loading" style="text-align:center; padding:1rem; color:var(--text-muted);">
            Checking for linked users...
        </div>

        <div id="linked-users-list" style="display:flex; flex-direction:column; gap:1rem;">
            <!-- Rendered via JS -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', path='js/user_profile.js') }}"></script>
{% endblock %}